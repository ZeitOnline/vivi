name: Build and deploy nightwatch tests

on:
  push:
    branches:
    - main
    paths:
    - '.github/workflows/nightwatch.yaml'
    - 'smoketest/**'
  pull_request:
    paths:
    - '.github/workflows/nightwatch.yaml'
    - 'smoketest/**'

jobs:
  build:
    uses: zeitonline/gh-action-workflows/.github/workflows/nightwatch-build.yaml@1.9
    secrets: inherit
    with:
      versions: smoketest/k8s/base/versions
      args: |
        --overrides='{ "spec": { "serviceAccount": "baseproject" } }' --env="HTTPS_PROXY=http://static-ip-proxy.ops.zeit.de:3128"

  # deploy happens via flux (on `main` branch)
