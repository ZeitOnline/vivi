name: pre-commit

on:
  push:
    branches:
    - main
  pull_request:

env:
  PROJECT: vivi
  BUILD_URL: "${{github.server_url}}/${{github.repository}}/actions/runs/${{github.run_id}}"

concurrency: precommit_branch_${{github.ref_name}}

jobs:
  pre-commit:
    runs-on: zon-ubuntu-general-dind
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    - uses: actions/setup-python@0b93645e9fea7318ecaed2b359559ac225c90a2b # v5.3.0
      with:
        python-version: "3.12"
    - uses: pre-commit/action@2c7b3805fd2a0fd8c1884dcaebf91fc102a13ecd # v3.0.1

    - uses: slackapi/slack-github-action@fcfb566f8b0aab22203f066d80ca1d7e4b5d05b3 # v1.27.1
      if: failure() && github.ref_name == 'main'
      with:
        channel-id: "${{secrets.SLACK_TEAM_CONTENT_CHANNEL_ID}}"
        slack-message: ":small_red_triangle_down: <${{env.BUILD_URL}}|${{env.PROJECT}}> tests failed"
      env:
        SLACK_BOT_TOKEN: ${{secrets.SLACK_BOT_TOKEN}}
