================
Image transforms
================

The transforms create thumbnails and may later be extended for rotating images
or alike.

>>> import zeit.cms.testing
>>> zeit.cms.testing.set_site()
>>> import zeit.content.image.testing
>>> _ = zeit.content.image.testing.create_image_group_with_master_image()


Resizing
========

Thumbnails
++++++++++

An image can be adapted to ITransform which can create thumbnail images. For
thumbnails a bounding box is defined in which the image is placed into.

>>> import zope.component
>>> import zeit.cms.repository.interfaces
>>> import zeit.content.image.interfaces
>>> repository = zope.component.getUtility(
...     zeit.cms.repository.interfaces.IRepository)
>>> image = repository['2006']['DSC00109_2.JPG']
>>> import zeit.cms.checkout.helper
>>> p = zeit.cms.testing.create_interaction()
>>> with zeit.cms.checkout.helper.checked_out(image):
...     pass
>>> image = repository['2006']['DSC00109_2.JPG']
>>> transform = zeit.content.image.interfaces.ITransform(image)
>>> import zope.interface.verify
>>> zope.interface.verify.verifyObject(
...     zeit.content.image.interfaces.ITransform, transform)
True
>>> transform
<zeit.content.image.transform.ImageTransform...>


Persistent Thumbnails
=====================

It is sometimes required to have persistent thumbnails. An image can therefore
be adapted to IPersistentThumbnail:

>>> persistent_thumbnail = zeit.content.image.interfaces.IPersistentThumbnail(
...     image)

The persistent thumbnail is an image itself:

>>> persistent_thumbnail
<zeit.content.image.image.RepositoryImage...>
>>> persistent_thumbnail.getImageSize()
(50, 37)

It is contained in the folder `thumbnails` with the same name as the image:

>>> image.uniqueId
'http://xml.zeit.de/2006/DSC00109_2.JPG'
>>> persistent_thumbnail.uniqueId
'http://xml.zeit.de/2006/thumbnails/DSC00109_2.JPG'


When adapting again, no new thumbnail is created but the one in the repository
is used:

>>> zeit.content.image.interfaces.IPersistentThumbnail(
...     image) == persistent_thumbnail
True

We can change the thumbnail size via config:

>>> config = {
...     'thumbnail-width': '200',
...     'thumbnail-height': '200'}
>>> import zope.app.appsetup.product
>>> zope.app.appsetup.product.setProductConfiguration(
...     'zeit.content.image', config)

We need to delete the persistent thumbnail as thumbnails are not automatically
invalidated:

>>> del persistent_thumbnail.__parent__[persistent_thumbnail.__name__]
>>> persistent_thumbnail = zeit.content.image.interfaces.IPersistentThumbnail(
...     image)
>>> persistent_thumbnail.getImageSize()
(200, 150)
